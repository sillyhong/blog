<body>
<div class="nav">
    <div class="logo">
        
                    珠峰架构师成长计划
                        
                        </div>
                        <ul><li><a href="../index.html">0.Async</a></li><li><a href="../html/0.editor.html">0.editor</a></li><li><a href="../html/0.module.html">0.module</a></li><li><a href="../html/1.ES2015.html">1.ES2015</a></li><li><a href="../html/2.Promise.html">2.Promise</a></li><li><a href="../html/3.Node.html">3.Node</a></li><li><a href="../html/4.NodeInstall.html">4.NodeInstall</a></li><li><a href="../html/5.REPL.html">5.REPL</a></li><li><a href="../html/6.NodeCore.html">6.NodeCore</a></li><li><a href="../html/7.module&amp;NPM.html">7.module&amp;NPM</a></li><li><a href="../html/8.Encoding.html">8.Encoding</a></li><li><a href="../html/9.Buffer.html">9.Buffer</a></li><li><a href="../html/10.fs.html">10.fs</a></li><li><a href="../html/11.Stream-1.html">11.Stream-1</a></li><li><a href="../html/11.Stream-2.html">11.Stream-2</a></li><li><a href="../html/11.Stream-3.html">11.Stream-3</a></li><li><a href="../html/11.Stream-4.html">11.Stream-4</a></li><li><a href="../html/12-Network-2.html">12-Network-2</a></li><li><a href="../html/12.NetWork-3.html">12.NetWork-3</a></li><li><a href="../html/12.Network-1.html">12.Network-1</a></li><li><a href="../html/13.tcp.html">13.tcp</a></li><li><a href="../html/14.http-1.html">14.http-1</a></li><li><a href="../html/14.http-2.html">14.http-2</a></li><li><a href="../html/15.compress.html">15.compress</a></li><li><a href="../html/16.crypto.html">16.crypto</a></li><li><a href="../html/17.process.html">17.process</a></li><li><a href="../html/18.yargs.html">18.yargs</a></li><li><a href="../html/19.cache.html">19.cache</a></li><li><a href="../html/20.action.html">20.action</a></li><li><a href="../html/21.https.html">21.https</a></li><li><a href="../html/22.cookie.html">22.cookie</a></li><li><a href="../html/23.session.html">23.session</a></li><li><a href="../html/24.express-1.html">24.express-1</a></li><li><a href="../html/24.express-2.html">24.express-2</a></li><li><a href="../html/24.express-3.html">24.express-3</a></li><li><a href="../html/24.express-4.html">24.express-4</a></li><li><a href="../html/25.koa-1.html">25.koa-1</a></li><li><a href="../html/26.webpack-1-basic.html">26.webpack-1-basic</a></li><li><a href="../html/26.webpack-2-optimize.html">26.webpack-2-optimize</a></li><li><a href="../html/26.webpack-3-file.html">26.webpack-3-file</a></li><li><a href="../html/26.webpack-4.tapable.html">26.webpack-4.tapable</a></li><li><a href="../html/26.webpack-5-AST.html">26.webpack-5-AST</a></li><li><a href="../html/26.webpack-6-sources.html">26.webpack-6-sources</a></li><li><a href="../html/26.webpack-7-loader.html">26.webpack-7-loader</a></li><li><a href="../html/26.webpack-8-plugin.html">26.webpack-8-plugin</a></li><li><a href="../html/26.webpack-9-hand.html">26.webpack-9-hand</a></li><li><a href="../html/26.webpack-10-prepare.html">26.webpack-10-prepare</a></li><li><a href="../html/28.redux.html">28.redux</a></li><li><a href="../html/28.redux-jwt-back.html">28.redux-jwt-back</a></li><li><a href="../html/28.redux-jwt-front.html">28.redux-jwt-front</a></li><li><a href="../html/29.mongodb-1.html">29.mongodb-1</a></li><li><a href="../html/29.mongodb-2.html">29.mongodb-2</a></li><li><a href="../html/29.mongodb-3.html">29.mongodb-3</a></li><li><a href="../html/29.mongodb-4.html">29.mongodb-4</a></li><li><a href="../html/29.mongodb-5.html">29.mongodb-5</a></li><li><a href="../html/29.mongodb-6.html">29.mongodb-6</a></li><li><a href="../html/30.cms-1-mysql.html">30.cms-1-mysql</a></li><li><a href="../html/30.cms-2-mysql.html">30.cms-2-mysql</a></li><li><a href="../html/30.cms-3-mysql.html">30.cms-3-mysql</a></li><li><a href="../html/30.cms-4-nunjucks.html">30.cms-4-nunjucks</a></li><li><a href="../html/30.cms-5-mock.html">30.cms-5-mock</a></li><li><a href="../html/30.cms-6-egg.html">30.cms-6-egg</a></li><li><a href="../html/30.cms-7-api.html">30.cms-7-api</a></li><li><a href="../html/30.cms-8-roadhog.html">30.cms-8-roadhog</a></li><li><a href="../html/30.cms-9-yaml.html">30.cms-9-yaml</a></li><li><a href="../html/30.cms-10-umi.html">30.cms-10-umi</a></li><li><a href="../html/30.cms-12-dva.html">30.cms-12-dva</a></li><li><a href="../html/30.cms-13-dva-ant.html">30.cms-13-dva-ant</a></li><li><a href="../html/30.cms-14-front.html">30.cms-14-front</a></li><li><a href="../html/30.cms-15-deploy.html">30.cms-15-deploy</a></li><li><a href="../html/31.dva.html">31.dva</a></li><li><a href="../html/31.cms-13-dva-antdesign.html">31.cms-13-dva-antdesign</a></li><li><a href="../html/33.redis.html">33.redis</a></li><li><a href="../html/34.unittest.html">34.unittest</a></li><li><a href="../html/35.jwt.html">35.jwt</a></li><li><a href="../html/36.websocket-1.html">36.websocket-1</a></li><li><a href="../html/36.websocket-2.html">36.websocket-2</a></li><li><a href="../html/38.chat-api-1.html">38.chat-api-1</a></li><li><a href="../html/38.chat-api-2.html">38.chat-api-2</a></li><li><a href="../html/38.chat-3.html">38.chat-3</a></li><li><a href="../html/38.chat-api-3.html">38.chat-api-3</a></li><li><a href="../html/38.chat.html">38.chat</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/39.crawl-0.html">39.crawl-0</a></li><li><a href="../html/39.crawl-1.html">39.crawl-1</a></li><li><a href="../html/39.crawl-2.html">39.crawl-2</a></li><li><a href="../html/40.deploy.html">40.deploy</a></li><li><a href="../html/41.safe.html">41.safe</a></li><li><a href="../html/42.test.html">42.test</a></li><li><a href="../html/43.nginx.html">43.nginx</a></li><li><a href="../html/44.enzyme.html">44.enzyme</a></li><li><a href="../html/45.docker.html">45.docker</a></li><li><a href="../html/46.elastic.html">46.elastic</a></li><li><a href="../html/47.oauth.html">47.oauth</a></li><li><a href="../html/48.wxpay.html">48.wxpay</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/52.UML.html">52.UML</a></li><li><a href="../html/53.design.html">53.design</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/54.linux.html">54.linux</a></li><li><a href="../html/57.ts.html">57.ts</a></li><li><a href="../html/56.react-ssr.html">56.react-ssr</a></li><li><a href="../html/58.ts_react.html">58.ts_react</a></li><li><a href="../html/59.ketang.html">59.ketang</a></li><li><a href="../html/59.ketang2.html">59.ketang2</a></li><li><a href="../html/61.1.devops-linux.html">61.1.devops-linux</a></li><li><a href="../html/61.2.devops-vi.html">61.2.devops-vi</a></li><li><a href="../html/61.3.devops-user.html">61.3.devops-user</a></li><li><a href="../html/61.4.devops-auth.html">61.4.devops-auth</a></li><li><a href="../html/61.5.devops-shell.html">61.5.devops-shell</a></li><li><a href="../html/61.6.devops-install.html">61.6.devops-install</a></li><li><a href="../html/61.7.devops-system.html">61.7.devops-system</a></li><li><a href="../html/61.8.devops-service.html">61.8.devops-service</a></li><li><a href="../html/61.9.devops-network.html">61.9.devops-network</a></li><li><a href="../html/61.10.devops-nginx.html">61.10.devops-nginx</a></li><li><a href="../html/61.11.devops-docker.html">61.11.devops-docker</a></li><li><a href="../html/61.12.devops-jekins.html">61.12.devops-jekins</a></li><li><a href="../html/61.13.devops-groovy.html">61.13.devops-groovy</a></li><li><a href="../html/61.14.devops-php.html">61.14.devops-php</a></li><li><a href="../html/61.15.devops-java.html">61.15.devops-java</a></li><li><a href="../html/61.16.devops-node.html">61.16.devops-node</a></li><li><a href="../html/61.17.devops-k8s.html">61.17.devops-k8s</a></li><li><a href="../html/62.1.react-basic.html">62.1.react-basic</a></li><li><a href="../html/62.2.react-state.html">62.2.react-state</a></li><li><a href="../html/62.3.react-high.html">62.3.react-high</a></li><li><a href="../html/62.4.react-optimize.html">62.4.react-optimize</a></li><li><a href="../html/62.5.react-hooks.html">62.5.react-hooks</a></li><li><a href="../html/62.6.react-immutable.html">62.6.react-immutable</a></li><li><a href="../html/62.7.react-mobx.html">62.7.react-mobx</a></li><li><a href="../html/62.8.react-source.html">62.8.react-source</a></li><li><a href="../html/63.1.redux.html">63.1.redux</a></li><li><a href="../html/63.2.redux-middleware.html">63.2.redux-middleware</a></li><li><a href="../html/63.3.redux-hooks.html">63.3.redux-hooks</a></li><li><a href="../html/63.4.redux-saga.html">63.4.redux-saga</a></li><li><a href="../html/63.5.redux-saga-hand.html">63.5.redux-saga-hand</a></li><li><a href="../html/64.1.router.html">64.1.router</a></li><li><a href="../html/64.2.router-connected.html">64.2.router-connected</a></li><li><a href="../html/65.1.typescript.html">65.1.typescript</a></li><li><a href="../html/65.2.typescript.html">65.2.typescript</a></li><li><a href="../html/65.3.typescript.html">65.3.typescript</a></li><li><a href="../html/65.4.antd.html">65.4.antd</a></li><li><a href="../html/65.4.definition.html">65.4.definition</a></li><li><a href="../html/66-1.vue-base.html">66-1.vue-base</a></li><li><a href="../html/66-2.vue-component.html">66-2.vue-component</a></li><li><a href="../html/66-3.vue-cli3.0.html">66-3.vue-cli3.0</a></li><li><a href="../html/66-4.$message组件.html">66-4.$message组件</a></li><li><a href="../html/66-5.Form组件.html">66-5.Form组件</a></li><li><a href="../html/66-6.tree.html">66-6.tree</a></li><li><a href="../html/66-7.vue-router-apply.html">66-7.vue-router-apply</a></li><li><a href="../html/66-8.axios-apply.html">66-8.axios-apply</a></li><li><a href="../html/66-9.vuex-apply.html">66-9.vuex-apply</a></li><li><a href="../html/66-10.jwt-vue.html">66-10.jwt-vue</a></li><li><a href="../html/66-11.vue-ssr.html">66-11.vue-ssr</a></li><li><a href="../html/66-12.nuxt-apply.html">66-12.nuxt-apply</a></li><li><a href="../html/66-13.pwa.html">66-13.pwa</a></li><li><a href="../html/66-14.vue单元测试.html">66-14.vue单元测试</a></li><li><a href="../html/66-15.权限校验.html">66-15.权限校验</a></li><li><a href="../html/67-1-network.html">67-1-network</a></li><li><a href="../html/68-2-wireshark.html">68-2-wireshark</a></li><li><a href="../html/7.npm2.html">7.npm2</a></li><li><a href="../html/69-hooks.html">69-hooks</a></li><li><a href="../html/70-deploy.html">70-deploy</a></li><li><a href="../html/71-hmr.html">71-hmr</a></li><li><a href="../html/72.deploy.html">72.deploy</a></li><li><a href="../html/73.import.html">73.import</a></li><li><a href="../html/74.mobile.html">74.mobile</a></li><li><a href="../html/75.webpack-1.文件分析.html">75.webpack-1.文件分析</a></li><li><a href="../html/75.webpack-2.loader.html">75.webpack-2.loader</a></li><li><a href="../html/75.webpack-3.源码流程.html">75.webpack-3.源码流程</a></li><li><a href="../html/75.webpack-4.tapable.html">75.webpack-4.tapable</a></li><li><a href="../html/75.webpack-5.prepare.html">75.webpack-5.prepare</a></li><li><a href="../html/75.webpack-6.resolve.html">75.webpack-6.resolve</a></li><li><a href="../html/75.webpack-7.loader.html">75.webpack-7.loader</a></li><li><a href="../html/75.webpack-8.module.html">75.webpack-8.module</a></li><li><a href="../html/75.webpack-9.chunk.html">75.webpack-9.chunk</a></li><li><a href="../html/75.webpack-10.asset.html">75.webpack-10.asset</a></li><li><a href="../html/75.webpack-11.实现.html">75.webpack-11.实现</a></li><li><a href="../html/76.react_optimize.html">76.react_optimize</a></li><li><a href="../html/77.ts_ketang_back.html">77.ts_ketang_back</a></li><li><a href="../html/77.ts_ketang_front.html">77.ts_ketang_front</a></li><li><a href="../html/78.vue-domdiff.html">78.vue-domdiff</a></li><li><a href="../html/79.grammar.html">79.grammar</a></li><li><a href="../html/80.tree.html">80.tree</a></li><li><a href="../html/81.axios.html">81.axios</a></li><li><a href="../html/82.1.react.html">82.1.react</a></li><li><a href="../html/82.2.react-high.html">82.2.react-high</a></li><li><a href="../html/82.3.react-router.html">82.3.react-router</a></li><li><a href="../html/82.4.redux.html">82.4.redux</a></li><li><a href="../html/82.5.redux_middleware.html">82.5.redux_middleware</a></li><li><a href="../html/82.6.connected.html">82.6.connected</a></li><li><a href="../html/82.7.saga.html">82.7.saga</a></li><li><a href="../html/82.8.dva.html">82.8.dva</a></li><li><a href="../html/82.8.dva-source.html">82.8.dva-source</a></li><li><a href="../html/82.9.roadhog.html">82.9.roadhog</a></li><li><a href="../html/82.10.umi.html">82.10.umi</a></li><li><a href="../html/82.11.antdesign.html">82.11.antdesign</a></li><li><a href="../html/82.12.ketang-front.html">82.12.ketang-front</a></li><li><a href="../html/82.12.ketang-back.html">82.12.ketang-back</a></li><li><a href="../html/83.upload.html">83.upload</a></li><li><a href="../html/84.graphql.html">84.graphql</a></li><li><a href="../html/85.antpro.html">85.antpro</a></li><li><a href="../html/86.1.uml.html">86.1.uml</a></li><li><a href="../html/86.2.design.html">86.2.design</a></li><li><a href="../html/87.postcss.html">87.postcss</a></li><li><a href="../html/88.react16-1.html">88.react16-1</a></li><li><a href="../html/89.nextjs.html">89.nextjs</a></li><li><a href="../html/90.react-test.html">90.react-test</a></li><li><a href="../html/91.react-ts.html">91.react-ts</a></li><li><a href="../html/92.rbac.html">92.rbac</a></li><li><a href="../html/93.tsnode.html">93.tsnode</a></li><li><a href="../html/94.1.JavaScript.html">94.1.JavaScript</a></li><li><a href="../html/94.2.JavaScript.html">94.2.JavaScript</a></li><li><a href="../html/94.3.MODULE.html">94.3.MODULE</a></li><li><a href="../html/94.4.EventLoop.html">94.4.EventLoop</a></li><li><a href="../html/94.5.文件上传.html">94.5.文件上传</a></li><li><a href="../html/94.6.https.html">94.6.https</a></li><li><a href="../html/94.7. nginx.html">94.7. nginx</a></li><li><a href="../html/95.1. react.html">95.1. react</a></li><li><a href="../html/95.2.react.html">95.2.react</a></li><li><a href="../html/96.1.react16.html">96.1.react16</a></li><li><a href="../html/96.2.fiber.html">96.2.fiber</a></li><li><a href="../html/96.3.fiber.html">96.3.fiber</a></li><li><a href="../html/97.serverless.html">97.serverless</a></li><li><a href="../html/98.websocket.html">98.websocket</a></li><li><a href="../html/100.1.react-basic.html">100.1.react-basic</a></li><li><a href="../html/101.1.monitor.html">101.1.monitor</a></li><li><a href="../html/101.2.monitor.html">101.2.monitor</a></li><li><a href="../html/102.java.html">102.java</a></li><li><a href="../html/103.1.webpack-usage.html">103.1.webpack-usage</a></li><li><a href="../html/103.2.webpack-bundle.html">103.2.webpack-bundle</a></li><li><a href="../html/103.3.webpack-ast.html">103.3.webpack-ast</a></li><li><a href="../html/103.4.webpack-flow.html">103.4.webpack-flow</a></li><li><a href="../html/103.5.webpack-loader.html">103.5.webpack-loader</a></li><li><a href="../html/103.6.webpack-tapable.html">103.6.webpack-tapable</a></li><li><a href="../html/103.7.webpack-plugin.html">103.7.webpack-plugin</a></li><li><a href="../html/103.8.webpack-optimize1.html">103.8.webpack-optimize1</a></li><li><a href="../html/103.9.webpack-optimize2.html">103.9.webpack-optimize2</a></li><li><a href="../html/103.10.webpack-hand.html">103.10.webpack-hand</a></li><li><a href="../html/103.11.webpack-hmr.html">103.11.webpack-hmr</a></li><li><a href="../html/103.13.webpack5.html">103.13.webpack5</a></li><li><a href="../html/103.14.webpack-sourcemap.html">103.14.webpack-sourcemap</a></li><li><a href="../html/103.15.webpack-compiler1.html">103.15.webpack-compiler1</a></li><li><a href="../html/103.15.webpack-compiler2.html">103.15.webpack-compiler2</a></li><li><a href="../html/103.16.vite.basic.html">103.16.vite.basic</a></li><li><a href="../html/103.16.vite.source.html">103.16.vite.source</a></li><li><a href="../html/104.1.binary.html">104.1.binary</a></li><li><a href="../html/104.2.binary.html">104.2.binary</a></li><li><a href="../html/105.skeleton.html">105.skeleton</a></li><li><a href="../html/106.1.react.html">106.1.react</a></li><li><a href="../html/106.2.react_hooks.html">106.2.react_hooks</a></li><li><a href="../html/106.3.react_router.html">106.3.react_router</a></li><li><a href="../html/106.4.redux.html">106.4.redux</a></li><li><a href="../html/106.5.redux_middleware.html">106.5.redux_middleware</a></li><li><a href="../html/106.6.connected-react-router.html">106.6.connected-react-router</a></li><li><a href="../html/106.7.redux-saga.html">106.7.redux-saga</a></li><li><a href="../html/106.8.dva.html">106.8.dva</a></li><li><a href="../html/106.9.umi.html">106.9.umi</a></li><li><a href="../html/106.10.antpro.html">106.10.antpro</a></li><li><a href="../html/107.fiber.html">107.fiber</a></li><li><a href="../html/108.http.html">108.http</a></li><li><a href="../html/109.1.webpack_usage.html">109.1.webpack_usage</a></li><li><a href="../html/109.2.webpack_source.html">109.2.webpack_source</a></li><li><a href="../html/109.3.dll.html">109.3.dll</a></li><li><a href="../html/110.nest.js.html">110.nest.js</a></li><li><a href="../html/111.xstate.html">111.xstate</a></li><li><a href="../html/112.Form.html">112.Form</a></li><li><a href="../html/113.redux-saga.html">113.redux-saga</a></li><li><a href="../html/114.react+typescript.html">114.react+typescript</a></li><li><a href="../html/115.immer.html">115.immer</a></li><li><a href="../html/116.pro5.html">116.pro5</a></li><li><a href="../html/117.css-loader.html">117.css-loader</a></li><li><a href="../html/118.1.umi-core.html">118.1.umi-core</a></li><li><a href="../html/119.2.module-federation.html">119.2.module-federation</a></li><li><a href="../html/119.1.module-federation.html">119.1.module-federation</a></li><li><a href="../html/120.create-react-app.html">120.create-react-app</a></li><li><a href="../html/121.react-scripts.html">121.react-scripts</a></li><li><a href="../html/122.react-optimize.html">122.react-optimize</a></li><li><a href="../html/123.jsx-runtime.html">123.jsx-runtime</a></li><li><a href="../html/124.next.js.html">124.next.js</a></li><li><a href="../html/106.11.ketang.html">106.11.ketang</a></li><li><a href="../html/125.1.linux.html">125.1.linux</a></li><li><a href="../html/125.2.linux-vi.html">125.2.linux-vi</a></li><li><a href="../html/125.3.linux-user.html">125.3.linux-user</a></li><li><a href="../html/125.4.linux-auth.html">125.4.linux-auth</a></li><li><a href="../html/125.5.linux-shell.html">125.5.linux-shell</a></li><li><a href="../html/125.6.linux-install.html">125.6.linux-install</a></li><li><a href="../html/125.7.linux-system.html">125.7.linux-system</a></li><li><a href="../html/125.8.linux-service.html">125.8.linux-service</a></li><li><a href="../html/125.9.linux-network.html">125.9.linux-network</a></li><li><a href="../html/125.10.nginx.html">125.10.nginx</a></li><li><a href="../html/125.11.docker.html">125.11.docker</a></li><li><a href="../html/125.12.ci.html">125.12.ci</a></li><li><a href="../html/126.11.react-1.html">126.11.react-1</a></li><li><a href="../html/125.13.k8s.html">125.13.k8s</a></li><li><a href="../html/125.14.k8s.html">125.14.k8s</a></li><li><a href="../html/125.15.k8s.html">125.15.k8s</a></li><li><a href="../html/125.16.k8s.html">125.16.k8s</a></li><li><a href="../html/126.12.react-2.html">126.12.react-2</a></li><li><a href="../html/126.12.react-3.html">126.12.react-3</a></li><li><a href="../html/127.frontend.html">127.frontend</a></li><li><a href="../html/128.rollup.html">128.rollup</a></li><li><a href="../html/129.px2rem-loader.html">129.px2rem-loader</a></li><li><a href="../html/130.health.html">130.health</a></li><li><a href="../html/131.hooks.html">131.hooks</a></li><li><a href="../html/126.12.react-4.html">126.12.react-4</a></li><li><a href="../html/132.keepalive.html">132.keepalive</a></li><li><a href="../html/133.vue-cli.html">133.vue-cli</a></li><li class="active"><a href="../html/134.react18.html">134.react18</a></li><li><a href="../html/119.4.EMP.html">119.4.EMP</a></li></ul>                        </div>

                        
<div class="warpper">
    <div class="page-toc">
        <ul><li><a href="#t01. React18介绍">1. React18介绍</a></li><li><a href="#t12. 并发模式(concurrent mode)">2. 并发模式(concurrent mode)</a><ul><li><a href="#t22.1 更新优先级">2.1 更新优先级</a></li><li><a href="#t32.2 双缓冲">2.2 双缓冲</a></li></ul></li><li><a href="#t43.搭建开发环境">3.搭建开发环境</a><ul><li><a href="#t53.1 vite">3.1 vite</a></li><li><a href="#t63.2 安装">3.2 安装</a></li><li><a href="#t73.3 vite.config.ts">3.3 vite.config.ts</a></li><li><a href="#t83.4 tsconfig.json">3.4 tsconfig.json</a></li><li><a href="#t93.5 package.json">3.5 package.json</a></li><li><a href="#t103.6 index.html">3.6 index.html</a></li><li><a href="#t113.7 src\main.tsx">3.7 src\main.tsx</a></li><li><a href="#t123.8 启动">3.8 启动</a></li></ul></li><li><a href="#t134.批量更新">4.批量更新</a><ul><li><a href="#t144.1 安装路由">4.1 安装路由</a></li><li><a href="#t154.2 src\main.tsx">4.2 src\main.tsx</a></li><li><a href="#t164.3 BatchState.tsx">4.3 BatchState.tsx</a></li></ul></li><li><a href="#t175.Suspense">5.Suspense</a><ul><li><a href="#t185.1 src\main.tsx">5.1 src\main.tsx</a></li><li><a href="#t195.2 ErrorBoundary.tsx">5.2 ErrorBoundary.tsx</a></li><li><a href="#t205.3 Suspense.tsx">5.3 Suspense.tsx</a></li><li><a href="#t215.4 Suspense.tsx">5.4 Suspense.tsx</a></li></ul></li><li><a href="#t226.SuspenseList">6.SuspenseList</a><ul><li><a href="#t236.1 src\main.tsx">6.1 src\main.tsx</a></li><li><a href="#t246.2 SuspenseList.tsx">6.2 SuspenseList.tsx</a></li></ul></li><li><a href="#t257.startTransition">7.startTransition</a><ul><li><a href="#t267.1 src\main.tsx">7.1 src\main.tsx</a></li><li><a href="#t277.2 StartTransition.tsx">7.2 StartTransition.tsx</a></li></ul></li><li><a href="#t288.useDeferredValue">8.useDeferredValue</a><ul><li><a href="#t298.1 src\main.tsx">8.1 src\main.tsx</a></li><li><a href="#t308.2 UseDeferredValue.tsx">8.2 UseDeferredValue.tsx</a></li></ul></li><li><a href="#t319.useTransition">9.useTransition</a><ul><li><a href="#t329.1 src\main.tsx">9.1 src\main.tsx</a></li><li><a href="#t339.2 UseTransition.tsx">9.2 UseTransition.tsx</a></li></ul></li></ul>
    </div>
    <div class="content markdown-body">
        <h2 id="t01. React18介绍">1. React18介绍 <a href="#t01. React18介绍"> # </a></h2>
<ul>
<li><a href="https://zh-hans.reactjs.org/blog/2021/06/08/the-plan-for-react-18.html">React 18发布计划</a></li>
<li><a href="https://github.com/reactwg/react-18/discussions">React 18 工作组</a></li>
<li><a href="https://github.com/reactwg/react-18/discussions/41">startTransition</a></li>
<li><a href="https://github.com/reactwg/react-18/discussions/37">React.lazy的全新SSR 架构</a></li>
</ul>
<h2 id="t12. 并发模式(concurrent mode)">2. 并发模式(concurrent mode) <a href="#t12. 并发模式(concurrent mode)"> # </a></h2>
<ul>
<li>在React 18中新加入的可选的<a href="https://zh-hans.reactjs.org/docs/concurrent-mode-intro.html">并发渲染(concurrent rendering)</a>机制</li>
<li>Concurrent 模式是一组 React 的新功能，可帮助应用保持响应，并根据用户的设备性能和网速进行适当的调整</li>
<li>在 Concurrent 模式中，渲染不是阻塞的。它是可中断的</li>
</ul>
<h3 id="t22.1 更新优先级">2.1 更新优先级 <a href="#t22.1 更新优先级"> # </a></h3>
<ul>
<li>以前更新没有优先级的概念,优先级高的更新并不能打断之前的更新,需要等前面的更新完成后才能进行</li>
<li>用户对不同的操作对交互的执行速度有不同的预期,所以我们可以根据用户的预期赋予更新不同的优先级<ul>
<li>高优先级  用户输入、窗口缩放和拖拽事件等</li>
<li>低优先级  数据请求和下载文件等</li>
</ul>
</li>
<li>高优先级的更新会中断正在进行的低优先级的更新</li>
<li>等高优先级更新完成后,低优先级基于高优先级更新的结果重新更新</li>
<li>对于 <code>CPU-bound</code> 的更新 (例如创建新的 DOM 节点和运行组件中的代码)，并发意味着一个更急迫的更新可以“中断”已经开始的渲染</li>
</ul>
<p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/jia_sai_1625651545473.jpeg" alt="jia_sai_1625651545473"></p>
<p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/bing_fa_geng_xin_1625649988239.jpg" alt="bing_fa_geng_xin"></p>
<h3 id="t32.2 双缓冲">2.2 双缓冲 <a href="#t32.2 双缓冲"> # </a></h3>
<ul>
<li>当数据量很大时，绘图可能需要几秒钟甚至更长的时间，而且有时还会出现闪烁现象，为了解决这些问题，可采用双缓冲技术来绘图</li>
<li><a href="https://wiki.osdev.org/Double_Buffering">双缓冲</a>即在内存中创建一个与屏幕绘图区域一致的对象，先将图形绘制到内存中的这个对象上，再一次性将这个对象上的图形拷贝到屏幕上，这样能大大加快绘图的速度</li>
<li>对于 <code>IO-bound</code>的更新 (例如从网络加载代码或数据)，并发意味着 React 甚至可以在全部数据到达之前就在内存中开始渲染，然后跳过令人不愉快的空白加载状态</li>
</ul>
<p><img src="https://upload-markdown-images.oss-cn-beijing.aliyuncs.com/shuang_huan_cun_hui_tu_1625651174010.jpg" alt="shuang_huan_cun_hui_tu"></p>
<h2 id="t43.搭建开发环境">3.搭建开发环境 <a href="#t43.搭建开发环境"> # </a></h2>
<h3 id="t53.1 vite">3.1 vite <a href="#t53.1 vite"> # </a></h3>
<ul>
<li>Vite是Vue的作者开发的Web开发构建工具</li>
<li>它是一个基于浏览器原生ES模块导入的开发服务器</li>
<li>在开发环境下，利用浏览器去解析import，在服务器端按需编译返回，完全跳过了打包这个概念</li>
<li>服务器随启随用</li>
<li>同时不仅对Vue文件提供了支持，还支持热更新，而且热更新的速度不会随着模块增多而变慢</li>
</ul>
<h3 id="t63.2 安装">3.2 安装 <a href="#t63.2 安装"> # </a></h3>
<ul>
<li><a href="plugin-react-refresh">plugin-react-refresh</a>支持react组件的热更新</li>
</ul>
<pre><code class="lang-js">npm install react@alpha react-dom@alpha @types/react @types/react-dom -S
npm install vite typescript @vitejs/plugin-react-refresh -D
node ./node_modules/esbuild/install.js
</code></pre>
<h3 id="t73.3 vite.config.ts">3.3 vite.config.ts <a href="#t73.3 vite.config.ts"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> reactRefresh <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react-refresh'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig({
  <span class="hljs-attr">plugins</span>: [reactRefresh()]
})
</code></pre>
<h3 id="t83.4 tsconfig.json">3.4 tsconfig.json <a href="#t83.4 tsconfig.json"> # </a></h3>
<p>tsconfig.json</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"compilerOptions"</span>: {
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"ESNext"</span>,
    <span class="hljs-attr">"lib"</span>: [<span class="hljs-string">"DOM"</span>, <span class="hljs-string">"DOM.Iterable"</span>, <span class="hljs-string">"ESNext"</span>],
    <span class="hljs-attr">"allowJs"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"skipLibCheck"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"esModuleInterop"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"allowSyntheticDefaultImports"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"strict"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"forceConsistentCasingInFileNames"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"module"</span>: <span class="hljs-string">"ESNext"</span>,
    <span class="hljs-attr">"moduleResolution"</span>: <span class="hljs-string">"Node"</span>,
    <span class="hljs-attr">"resolveJsonModule"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"isolatedModules"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"noEmit"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"jsx"</span>: <span class="hljs-string">"react"</span>,
    <span class="hljs-attr">"types"</span>: [<span class="hljs-string">"react/next"</span>, <span class="hljs-string">"react-dom/next"</span>]
  },
  <span class="hljs-attr">"include"</span>: [<span class="hljs-string">"./src"</span>]
}
</code></pre>
<h3 id="t93.5 package.json">3.5 package.json <a href="#t93.5 package.json"> # </a></h3>
<p>package.json</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"zhufeng-react18"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"tsc &amp;&amp; vite build"</span>
  },
  <span class="hljs-attr">"keywords"</span>: [],
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"ISC"</span>,
  <span class="hljs-attr">"dependencies"</span>: {
    <span class="hljs-attr">"react"</span>: <span class="hljs-string">"^18.0.0-alpha-ed6c091fe-20210701"</span>,
    <span class="hljs-attr">"react-dom"</span>: <span class="hljs-string">"^18.0.0-alpha-ed6c091fe-20210701"</span>
  },
  <span class="hljs-attr">"devDependencies"</span>: {
    <span class="hljs-attr">"@types/react"</span>: <span class="hljs-string">"^17.0.13"</span>,
    <span class="hljs-attr">"@types/react-dom"</span>: <span class="hljs-string">"^17.0.8"</span>,
    <span class="hljs-attr">"@vitejs/plugin-react-refresh"</span>: <span class="hljs-string">"^1.3.5"</span>,
    <span class="hljs-attr">"typescript"</span>: <span class="hljs-string">"^4.3.5"</span>,
    <span class="hljs-attr">"vite"</span>: <span class="hljs-string">"^2.4.1"</span>
  }
}
</code></pre>
<h3 id="t103.6 index.html">3.6 index.html <a href="#t103.6 index.html"> # </a></h3>
<ul>
<li><code>type='module'</code>可以导入<a href="https://www.sitepoint.com/using-es-modules/">ES6模块</a>,可以启用ESM模块机制</li>
</ul>
<p>index.html</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/src/favicon.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.tsx"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 id="t113.7 src\main.tsx">3.7 src\main.tsx <a href="#t113.7 src\main.tsx"> # </a></h3>
<ul>
<li><code>legacy</code>模式<code>ReactDOM.renders</code>会同步渲染</li>
<li><code>createRoot</code>会启用<code>concurrent</code>并发模式</li>
</ul>
<p>src\main.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>
ReactDOM.createRoot(
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)!
).render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>);
</code></pre>
<h3 id="t123.8 启动">3.8 启动 <a href="#t123.8 启动"> # </a></h3>
<pre><code class="lang-js">npm run dev
</code></pre>
<h2 id="t134.批量更新">4.批量更新 <a href="#t134.批量更新"> # </a></h2>
<ul>
<li><a href="https://github.com/reactwg/react-18/discussions/21">automatic batching</a></li>
<li>在<code>Concurrent</code>模式中更新是以优先级为依据进行合并的</li>
</ul>
<h3 id="t144.1 安装路由">4.1 安装路由 <a href="#t144.1 安装路由"> # </a></h3>
<ul>
<li>npm强制安装可以使用 <code>-f</code> 或 <code>--force</code> 参数<pre><code class="lang-js">npm install react-router-dom @types/react-router-dom --force -S
</code></pre>
</li>
</ul>
<h3 id="t154.2 src\main.tsx">4.2 src\main.tsx <a href="#t154.2 src\main.tsx"> # </a></h3>
<p>src\main.tsx</p>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
<span class="hljs-addition">+import {HashRouter as Router,Route,Link} from 'react-router-dom';</span>
<span class="hljs-addition">+import BatchState from './routes/BatchState';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
<span class="hljs-addition">+   &lt;Router&gt;</span>
<span class="hljs-addition">+       &lt;ul&gt;</span>
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;</span>
<span class="hljs-addition">+       &lt;/ul&gt;</span>
<span class="hljs-addition">+       &lt;Route path="/BatchState" component={BatchState}/&gt;</span>
<span class="hljs-addition">+   &lt;/Router&gt;</span>
);
</code></pre>
<h3 id="t164.3 BatchState.tsx">4.3 BatchState.tsx <a href="#t164.3 BatchState.tsx"> # </a></h3>
<p>src\routes\BatchState.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
interface Props { }
interface State {
    <span class="hljs-attr">count</span>: number
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span>&lt;<span class="hljs-title">Props</span>, <span class="hljs-title">State</span>&gt; </span>{
    state = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }
    handleCLick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">count</span>: <span class="hljs-keyword">this</span>.state.count + <span class="hljs-number">1</span> });
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"count"</span>, <span class="hljs-keyword">this</span>.state.count);
            <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">count</span>: <span class="hljs-keyword">this</span>.state.count + <span class="hljs-number">1</span> });
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"count"</span>, <span class="hljs-keyword">this</span>.state.count);
        }, <span class="hljs-number">0</span>);
    };

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleCLick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}
</code></pre>
<h2 id="t175.Suspense">5.Suspense <a href="#t175.Suspense"> # </a></h2>
<ul>
<li>Suspense 让你的组件在渲染之前进行<code>等待</code>，并在等待时显示<code>fallback</code>的内容</li>
<li>Suspense内的组件子树比组件树的其他部分拥有更低的优先级</li>
<li>执行流程<ul>
<li>在render函数中我们可以使用异步请求数据</li>
<li>react会从我们缓存中读取这个缓存</li>
<li>如果有缓存了，直接进行正常的render</li>
<li>如果没有缓存，那么会抛出一个promise异常</li>
<li>当这个promise完成后(比发请求数据完成)，react会继续回到原来的render中，把数据render出来</li>
<li>完全同步写法，没有任何异步<code>callback</code>之类的东西</li>
</ul>
</li>
<li>React提供了一个内置函数<code>componentDidCatch</code>,如果 <code>render()</code> 函数抛出错误，则会触发该函数</li>
<li>ErrorBoundary(错误边界)是一个组件，该组件会捕获到渲染期间(render)子组件发生的错误，并有能力阻止错误继续传播</li>
</ul>
<h3 id="t185.1 src\main.tsx">5.1 src\main.tsx <a href="#t185.1 src\main.tsx"> # </a></h3>
<p>src\main.tsx</p>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
import {HashRouter as Router,Route,Link} from 'react-router-dom';
import BatchState from './routes/BatchState';
<span class="hljs-addition">+import Suspense from './routes/Suspense';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
    &lt;Router&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/Suspense"&gt;Suspense&lt;/Link&gt;&lt;/li&gt;</span>
        &lt;/ul&gt;
        &lt;Route path="/BatchState" component={BatchState}/&gt;
<span class="hljs-addition">+       &lt;Route path="/Suspense" component={Suspense}/&gt;</span>
    &lt;/Router&gt;
);
</code></pre>
<h3 id="t195.2 ErrorBoundary.tsx">5.2 ErrorBoundary.tsx <a href="#t195.2 ErrorBoundary.tsx"> # </a></h3>
<p>src\components\ErrorBoundary.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
interface Props{
    <span class="hljs-attr">fallback</span>:React.ReactNode
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">Props</span>&gt; </span>{
  state = {<span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>};
  <span class="hljs-keyword">static</span> getDerivedStateFromError(error:any) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span>,
      error,
    };
  }
  render() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.state.hasError) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.fallback;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.children;
  }
}
</code></pre>
<h3 id="t205.3 Suspense.tsx">5.3 Suspense.tsx <a href="#t205.3 Suspense.tsx"> # </a></h3>
<p>src\routes\Suspense.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component, Suspense } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> ErrorBoundary <span class="hljs-keyword">from</span> <span class="hljs-string">"../components/ErrorBoundary"</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createResource</span>(<span class="hljs-params">promise: Promise&lt;any&gt;</span>) </span>{
    <span class="hljs-keyword">let</span> status = <span class="hljs-string">'pending'</span>;
    <span class="hljs-keyword">let</span> result: any;
    <span class="hljs-keyword">return</span> {
        read() {
            <span class="hljs-keyword">if</span> (status === <span class="hljs-string">'success'</span> || status === <span class="hljs-string">'error'</span>) {
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> promise.then(<span class="hljs-function">(<span class="hljs-params">data: any</span>) =&gt;</span> {
                    status = <span class="hljs-string">'success'</span>;
                    result = data;
                }, (error: any) =&gt; {
                    status = <span class="hljs-string">'error'</span>;
                    result = error;
                });
            }
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchData</span>(<span class="hljs-params">id: number</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            resolve({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: { id, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> } });
            <span class="hljs-comment">//reject({success:false,message:'获取数据发生了错误'});</span>
        }, <span class="hljs-number">1000</span>);
    });
}
<span class="hljs-keyword">const</span> initialResource = createResource(fetchData(<span class="hljs-number">1</span>));
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">User</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> result = initialResource.read();
    <span class="hljs-keyword">if</span> (result.success) {
        <span class="hljs-keyword">let</span> user = result.data;
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{user.id}:{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{result.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>出错了<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>加载中<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                    <span class="hljs-tag">&lt;<span class="hljs-name">User</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
        );
    }
}
</code></pre>
<h3 id="t215.4 Suspense.tsx">5.4 Suspense.tsx <a href="#t215.4 Suspense.tsx"> # </a></h3>
<p>src\components\Suspense.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
interface SuspenseProps {
    <span class="hljs-attr">fallback</span>: React.ReactNode
}
interface SuspenseState {
    <span class="hljs-attr">loading</span>: boolean
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Suspense</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">SuspenseProps</span>, <span class="hljs-title">SuspenseState</span>&gt; </span>{
    <span class="hljs-attr">mounted</span>: any = <span class="hljs-literal">null</span>
    state = { <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> };
    componentDidCatch(error: any) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> error.then === <span class="hljs-string">'function'</span>) {
            <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> });
            error.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }) });
        }
    }
    render() {
        <span class="hljs-keyword">const</span> { fallback, children } = <span class="hljs-keyword">this</span>.props;
        <span class="hljs-keyword">const</span> { loading } = <span class="hljs-keyword">this</span>.state;
        <span class="hljs-keyword">return</span> loading ? fallback : children;
    }
}
</code></pre>
<h2 id="t226.SuspenseList">6.SuspenseList <a href="#t226.SuspenseList"> # </a></h2>
<ul>
<li>SuspenseList 通过编排向用户显示这些组件的顺序，来帮助协调许多可以挂起的组件</li>
<li>revealOrder (forwards, backwards, together) 定义了 SuspenseList 子组件应该显示的顺序<ul>
<li>together 在所有的子组件都准备好了的时候显示它们，而不是一个接着一个显示</li>
<li>forwards 从前往后显示</li>
<li>backwards 从后往前显示</li>
</ul>
</li>
<li>tail (collapsed, hidden) 指定如何显示 SuspenseList 中未加载的项目<ul>
<li>默认情况下，SuspenseList 将显示列表中的所有 fallback</li>
<li>collapsed 仅显示列表中下一个 fallback</li>
<li>hidden 未加载的项目不显示任何信息</li>
</ul>
</li>
</ul>
<h3 id="t236.1 src\main.tsx">6.1 src\main.tsx <a href="#t236.1 src\main.tsx"> # </a></h3>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
import {HashRouter as Router,Route,Link} from 'react-router-dom';
import BatchState from './routes/BatchState';
import Suspense from './routes/Suspense';
<span class="hljs-addition">+import SuspenseList from './routes/SuspenseList';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
    &lt;Router&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/Suspense"&gt;Suspense&lt;/Link&gt;&lt;/li&gt;
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/SuspenseList"&gt;SuspenseList&lt;/Link&gt;&lt;/li&gt;</span>
        &lt;/ul&gt;
        &lt;Route path="/BatchState" component={BatchState}/&gt;
        &lt;Route path="/Suspense" component={Suspense}/&gt;
<span class="hljs-addition">+       &lt;Route path="/SuspenseList" component={SuspenseList}/&gt;</span>
    &lt;/Router&gt;
);
</code></pre>
<h3 id="t246.2 SuspenseList.tsx">6.2 SuspenseList.tsx <a href="#t246.2 SuspenseList.tsx"> # </a></h3>
<p>src\routes\SuspenseList.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component, Suspense, SuspenseList } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> ErrorBoundary <span class="hljs-keyword">from</span> <span class="hljs-string">"../components/ErrorBoundary"</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createResource</span>(<span class="hljs-params">promise: Promise&lt;any&gt;</span>) </span>{
    <span class="hljs-keyword">let</span> status = <span class="hljs-string">'pending'</span>;
    <span class="hljs-keyword">let</span> result: any;
    <span class="hljs-keyword">return</span> {
        read() {
            <span class="hljs-keyword">if</span> (status === <span class="hljs-string">'success'</span> || status === <span class="hljs-string">'error'</span>) {
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> promise.then(<span class="hljs-function">(<span class="hljs-params">data: any</span>) =&gt;</span> {
                    status = <span class="hljs-string">'success'</span>;
                    result = data;
                }, (error: any) =&gt; {
                    status = <span class="hljs-string">'error'</span>;
                    result = error;
                });
            }
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchData</span>(<span class="hljs-params">id: number</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            resolve({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: { id, <span class="hljs-attr">name</span>: <span class="hljs-string">'姓名'</span> + id } });
            <span class="hljs-comment">//reject({success:false,message:'获取数据发生了错误'});</span>
        }, <span class="hljs-number">1000</span> * id);
    });
}

<span class="hljs-keyword">let</span> userResourceMap: any = {
    <span class="hljs-number">1</span>: createResource(fetchData(<span class="hljs-number">1</span>)),
    <span class="hljs-number">2</span>: createResource(fetchData(<span class="hljs-number">2</span>)),
    <span class="hljs-number">3</span>: createResource(fetchData(<span class="hljs-number">3</span>))
}
interface UserProps {
    <span class="hljs-attr">id</span>: number
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">User</span>(<span class="hljs-params">props: UserProps</span>) </span>{
    <span class="hljs-keyword">const</span> result = userResourceMap[props.id].read();
    <span class="hljs-keyword">if</span> (result.success) {
        <span class="hljs-keyword">let</span> user = result.data;
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{user.id}:{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{result.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>出错了<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">SuspenseList</span> <span class="hljs-attr">revealOrder</span>=<span class="hljs-string">"backwards"</span> <span class="hljs-attr">tail</span>=<span class="hljs-string">"collapsed"</span> &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>加载用户3......<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                        <span class="hljs-tag">&lt;<span class="hljs-name">User</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{3}</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>加载用户2......<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                        <span class="hljs-tag">&lt;<span class="hljs-name">User</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{2}</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>加载用户1......<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                        <span class="hljs-tag">&lt;<span class="hljs-name">User</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{1}</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">SuspenseList</span>&gt;</span>

            <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
        );
    }
}
</code></pre>
<h2 id="t257.startTransition">7.startTransition <a href="#t257.startTransition"> # </a></h2>
<ul>
<li><a href="https://zh-hans.reactjs.org/docs/concurrent-mode-reference.html">startTransition</a></li>
<li>startTransition 是一个接受回调的函数。我们用它来告诉 React 需要推迟的 state</li>
<li>允许组件将速度较慢的数据获取更新推迟到随后渲染，以便能够立即渲染更重要的更新</li>
</ul>
<h3 id="t267.1 src\main.tsx">7.1 src\main.tsx <a href="#t267.1 src\main.tsx"> # </a></h3>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
import {HashRouter as Router,Route,Link} from 'react-router-dom';
import BatchState from './routes/BatchState';
import Suspense from './routes/Suspense';
import SuspenseList from './routes/SuspenseList';
<span class="hljs-addition">+import StartTransition from './routes/StartTransition';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
    &lt;Router&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/Suspense"&gt;Suspense&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/SuspenseList"&gt;SuspenseList&lt;/Link&gt;&lt;/li&gt;
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/StartTransition"&gt;StartTransition&lt;/Link&gt;&lt;/li&gt;</span>
        &lt;/ul&gt;
        &lt;Route path="/BatchState" component={BatchState}/&gt;
        &lt;Route path="/Suspense" component={Suspense}/&gt;
        &lt;Route path="/SuspenseList" component={SuspenseList}/&gt;
<span class="hljs-addition">+       &lt;Route path="/StartTransition" component={StartTransition}/&gt;</span>
    &lt;/Router&gt;
);
</code></pre>
<h3 id="t277.2 StartTransition.tsx">7.2 StartTransition.tsx <a href="#t277.2 StartTransition.tsx"> # </a></h3>
<p>src\routes\StartTransition.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { startTransition, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSuggestions</span>(<span class="hljs-params">keyword: string</span>):<span class="hljs-title">Promise</span>&lt;<span class="hljs-title">Array</span>&lt;<span class="hljs-title">string</span>&gt;&gt; </span>{
  <span class="hljs-keyword">let</span> items =  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">10000</span>).fill(<span class="hljs-number">0</span>).map(<span class="hljs-function">(<span class="hljs-params">item: number, index: number</span>) =&gt;</span> keyword + index);
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(items);
}
interface SuggestionProps {
  <span class="hljs-attr">keyword</span>: string;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Suggestion</span>(<span class="hljs-params">props: SuggestionProps</span>) </span>{
  <span class="hljs-keyword">const</span> [suggestions, setSuggestions] = useState&lt;<span class="hljs-built_in">Array</span>&lt;string&gt;&gt;([]);
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    getSuggestions(props.keyword).then(<span class="hljs-function"><span class="hljs-params">suggestions</span> =&gt;</span> {
      startTransition(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        setSuggestions(suggestions);
      }) 
    })
  }, [props.keyword]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {
        suggestions.map((item: string) =&gt; (<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>))
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = useState&lt;string&gt;(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> handleChange = <span class="hljs-function">(<span class="hljs-params">event: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> {
    setKeyword(event.target.value);
  };
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      请输入商品关键字<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{keyword}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suggestion</span> <span class="hljs-attr">keyword</span>=<span class="hljs-string">{keyword}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 id="t288.useDeferredValue">8.useDeferredValue <a href="#t288.useDeferredValue"> # </a></h2>
<ul>
<li>返回一个延迟响应的值</li>
<li>在<code>useDeferredValue</code>内部会调用useState并触发一次更新,但此更新的优先级很低</li>
</ul>
<h3 id="t298.1 src\main.tsx">8.1 src\main.tsx <a href="#t298.1 src\main.tsx"> # </a></h3>
<p>src\main.tsx</p>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
import {HashRouter as Router,Route,Link} from 'react-router-dom';
import BatchState from './routes/BatchState';
import Suspense from './routes/Suspense';
import SuspenseList from './routes/SuspenseList';
import StartTransition from './routes/StartTransition';
<span class="hljs-addition">+import UseDeferredValue from './routes/UseDeferredValue';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
    &lt;Router&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/Suspense"&gt;Suspense&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/SuspenseList"&gt;SuspenseList&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/StartTransition"&gt;StartTransition&lt;/Link&gt;&lt;/li&gt;
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/UseDeferredValue"&gt;UseDeferredValue&lt;/Link&gt;&lt;/li&gt;</span>
        &lt;/ul&gt;
        &lt;Route path="/BatchState" component={BatchState}/&gt;
        &lt;Route path="/Suspense" component={Suspense}/&gt;
        &lt;Route path="/SuspenseList" component={SuspenseList}/&gt;
        &lt;Route path="/StartTransition" component={StartTransition}/&gt;
<span class="hljs-addition">+       &lt;Route path="/UseDeferredValue" component={UseDeferredValue}/&gt;</span>
    &lt;/Router&gt;
);
</code></pre>
<h3 id="t308.2 UseDeferredValue.tsx">8.2 UseDeferredValue.tsx <a href="#t308.2 UseDeferredValue.tsx"> # </a></h3>
<p>src\routes\UseDeferredValue.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { startTransition, useEffect, useState,useDeferredValue } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSuggestions</span>(<span class="hljs-params">keyword: string</span>):<span class="hljs-title">Promise</span>&lt;<span class="hljs-title">Array</span>&lt;<span class="hljs-title">string</span>&gt;&gt; </span>{
  <span class="hljs-keyword">let</span> items =  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">10000</span>).fill(<span class="hljs-number">0</span>).map(<span class="hljs-function">(<span class="hljs-params">item: number, index: number</span>) =&gt;</span> keyword + index);
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(items);
}
interface SuggestionProps {
  <span class="hljs-attr">keyword</span>: string;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Suggestion</span>(<span class="hljs-params">props: SuggestionProps</span>) </span>{
  <span class="hljs-keyword">const</span> [suggestions, setSuggestions] = useState&lt;<span class="hljs-built_in">Array</span>&lt;string&gt;&gt;([]);
  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    getSuggestions(props.keyword).then(<span class="hljs-function"><span class="hljs-params">suggestions</span> =&gt;</span> {
       setSuggestions(suggestions);
    })
  }, [props.keyword]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {
        suggestions.map((item: string) =&gt; (<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>))
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = useState(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> deferredText = useDeferredValue(keyword); 
  <span class="hljs-keyword">const</span> handleChange = <span class="hljs-function">(<span class="hljs-params">event: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> {
    setKeyword(event.target.value);
  };
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      请输入商品关键字<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{keyword}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suggestion</span> <span class="hljs-attr">keyword</span>=<span class="hljs-string">{deferredText}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 id="t319.useTransition">9.useTransition <a href="#t319.useTransition"> # </a></h2>
<ul>
<li><code>useTransition</code>允许组件在切换到下一个界面之前等待内容加载，从而避免不必要的加载状态</li>
<li>它还允许组件将速度较慢的数据获取更新推迟到随后渲染，以便能够立即渲染更重要的更新</li>
<li>useTransition hook 返回两个值的数组<ul>
<li>startTransition 是一个接受回调的函数。我们用它来告诉 React 需要推迟的 state</li>
<li>isPending 是一个布尔值。这是 React 通知我们是否正在等待过渡的完成的方式</li>
</ul>
</li>
<li>如果某个 state 更新导致组件挂起，则该 state 更新应包装在 transition 中</li>
</ul>
<h3 id="t329.1 src\main.tsx">9.1 src\main.tsx <a href="#t329.1 src\main.tsx"> # </a></h3>
<pre><code class="lang-diff">import React from 'react'
import ReactDOM from 'react-dom'
import {HashRouter as Router,Route,Link} from 'react-router-dom';
import BatchState from './routes/BatchState';
import Suspense from './routes/Suspense';
import SuspenseList from './routes/SuspenseList';
import StartTransition from './routes/StartTransition';
import UseDeferredValue from './routes/UseDeferredValue';
<span class="hljs-addition">+import UseTransition from './routes/UseTransition';</span>
ReactDOM.createRoot(
    document.getElementById('root')!
).render(
    &lt;Router&gt;
        &lt;ul&gt;
            &lt;li&gt;&lt;Link to="/BatchState"&gt;BatchState&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/Suspense"&gt;Suspense&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/SuspenseList"&gt;SuspenseList&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/StartTransition"&gt;StartTransition&lt;/Link&gt;&lt;/li&gt;
            &lt;li&gt;&lt;Link to="/UseDeferredValue"&gt;UseDeferredValue&lt;/Link&gt;&lt;/li&gt;
<span class="hljs-addition">+           &lt;li&gt;&lt;Link to="/UseTransition"&gt;UseTransition&lt;/Link&gt;&lt;/li&gt;</span>
        &lt;/ul&gt;
        &lt;Route path="/BatchState" component={BatchState}/&gt;
        &lt;Route path="/Suspense" component={Suspense}/&gt;
        &lt;Route path="/SuspenseList" component={SuspenseList}/&gt;
        &lt;Route path="/StartTransition" component={StartTransition}/&gt;
        &lt;Route path="/UseDeferredValue" component={UseDeferredValue}/&gt;
<span class="hljs-addition">+       &lt;Route path="/UseTransition" component={UseTransition}/&gt;</span>
    &lt;/Router&gt;
);
</code></pre>
<h3 id="t339.2 UseTransition.tsx">9.2 UseTransition.tsx <a href="#t339.2 UseTransition.tsx"> # </a></h3>
<p>src\routes\UseTransition.tsx</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component, Suspense, useTransition, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> ErrorBoundary <span class="hljs-keyword">from</span> <span class="hljs-string">"../components/ErrorBoundary"</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchData</span>(<span class="hljs-params">id: number</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            resolve({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: { id, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> + id } });
            <span class="hljs-comment">//reject({success:false,message:'获取数据发生了错误'});</span>
        }, <span class="hljs-number">3000</span>);
    });
}

interface UserProps {
    <span class="hljs-attr">resource</span>: any
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">User</span>(<span class="hljs-params">props: UserProps</span>) </span>{
    <span class="hljs-keyword">const</span> result = props.resource.read();
    <span class="hljs-keyword">if</span> (result.success) {
        <span class="hljs-keyword">let</span> user = result.data;
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{user.id}:{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{result.message}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createResource</span>(<span class="hljs-params">promise: Promise&lt;string&gt;</span>) </span>{
    <span class="hljs-keyword">let</span> status = <span class="hljs-string">'pending'</span>;
    <span class="hljs-keyword">let</span> result: any;
    <span class="hljs-keyword">return</span> {
        read() {
            <span class="hljs-keyword">if</span> (status === <span class="hljs-string">'success'</span> || status === <span class="hljs-string">'error'</span>) {
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> promise.then(<span class="hljs-function">(<span class="hljs-params">data: any</span>) =&gt;</span> {
                    status = <span class="hljs-string">'success'</span>;
                    result = data;
                }, (error: any) =&gt; {
                    status = <span class="hljs-string">'error'</span>;
                    result = error;
                });
            }
        }
    }
}
<span class="hljs-keyword">const</span> initialResource = createResource(fetchData(<span class="hljs-number">1</span>));
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> [resource, setResource] = useState(initialResource);
    <span class="hljs-keyword">const</span> [isPending, startTransition] = useTransition();
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>出错了<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}&gt;
                    <span class="hljs-tag">&lt;<span class="hljs-name">User</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">{resource}</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span>
            {isPending ? " 加载中..." : null}
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isPending}</span>
                <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                    //startTransition(() =&gt; {
                        setResource(createResource(fetchData(2)));
                    //});
                }}
            &gt;下一个用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
}
</code></pre>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script>
let zhufengjiagou = localStorage.getItem('zhufengjiagou');
const host = 'http://login.zhufengpeixun.com';
if(zhufengjiagou){
  fetch(host+'/check',{method:"GET",mode: 'cors',
　　headers: {'Content-Type': 'application/json', authorization: `Bearer ${zhufengjiagou}`}}).then(response => response.json()).then(res => {
    if(res.success){
     
    }else{
      $('#loginModal').modal('show')
    }
  }) 
}else{
   $('#loginModal').modal('show')
}

$('#loginModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)
  let username = modal.find('.modal-body #username').val();
  let password = modal.find('.modal-body #password').val();
  fetch(host+'/login',{method:"POST",mode: 'cors',
　　headers: {'Content-Type': 'application/json'},
　　body:JSON.stringify({username,password})}).then(response => response.json()).then(res => {
  console.log(res);
    if(res.success){
      localStorage.setItem('zhufengjiagou',res.zhufengjiagou);
    }else{
      window.location.href = 'http://www.zhufengpeixun.cn';
    }
  })
})
</script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
$('.logo').on('mouseenter',function(){
  $('.nav').height('450px');
})
$('.nav').on('mouseleave',function(){
  $('.nav').height('80px');
})
$('.logo').on('click',function(){
  $('.nav').css('display','none');
 $('.warpper').css('padding','0px');
})
</script>


</body>
